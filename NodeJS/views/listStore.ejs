<div class="container liststore-container">
    <% if (data.message) { %>
        <div class="alert alert-info">
            <%= data.message %> 
        </div>
    <% } %>
    <h1 class="liststore-title">Danh s√°ch c·ª≠a h√†ng</h1>
    <div id="map"></div> 
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const stores = <%- JSON.stringify(data.liststore) %>;
        console.log("D·ªØ li·ªáu c·ª≠a h√†ng: ", stores);

        let validStores = stores.filter(store => store.longitude && store.latitude);

        if (validStores.length === 0) {
            console.warn("Kh√¥ng c√≥ c·ª≠a h√†ng h·ª£p l·ªá ƒë·ªÉ hi·ªÉn th·ªã tr√™n b·∫£n ƒë·ªì.");
            return;
        }

        // Kh·ªüi t·∫°o b·∫£n ƒë·ªì v·ªõi v·ªã tr√≠ trung t√¢m c·ªßa c·ª≠a h√†ng ƒë·∫ßu ti√™n
        let firstStore = validStores[0];
        let map = L.map('map').setView([firstStore.latitude, firstStore.longitude], 12);

        // Th√™m layer b·∫£n ƒë·ªì n·ªÅn OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];
        let bounds = [];

        validStores.forEach(store => {
            let coords = [store.latitude, store.longitude];

            let marker = L.marker(coords).addTo(map)
                .bindPopup(`
                    <div class="popup-content">
                        <strong>${store.name}</strong><br>
                        üìç ${store.address}<br>
                        üïí M·ªü c·ª≠a: ${store.open_hours} - ƒê√≥ng c·ª≠a: ${store.close_hour}<br>
                        <a href="/editstore/${store.store_id}" class="edit-button">Ch·ªânh s·ª≠a</a>
                        <br>
                        <a href="/deletestore/${store.store_id}" class="delete-button" style="color: red;">X√≥a</a>
                    </div>
                `);

            markers.push(marker);
            bounds.push(coords);
        });

        // N·∫øu c√≥ nhi·ªÅu c·ª≠a h√†ng, t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh b·∫£n ƒë·ªì ƒë·ªÉ th·∫•y t·∫•t c·∫£
        if (validStores.length > 1) {
            map.fitBounds(bounds, { padding: [50, 50] });
        } else {
            map.setZoom(15); // N·∫øu ch·ªâ c√≥ 1 c·ª≠a h√†ng, zoom g·∫ßn h∆°n
        }
    });
</script>   